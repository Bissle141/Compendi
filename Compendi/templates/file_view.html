{% extends 'base.html' %}

{% block head %}{% endblock %}
{% block pageTitle %} {{open_file.name}} {% endblock %}

{% block body %}
    <!-- Edit section modal -->
    <div id="editSection" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="editSectionModal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="mymodal modal-content d-flex flex-column p-3">
                <div class="d-flex flex-row justify-content-end">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">X</button>
                </div>
            </div>
        </div>
    </div>



    <div id="file-body" class="m-4 d-flex flex-column flex-nowrap">
        <div id="file-header">
            <span class="bebas" style="font-size: 2rem;"> {{open_file.name}} </span>
        </div>

        <!-- Sections list -->
        <div class="accordion" id="sectionsAccordion">
            {% if sections != None %}
                {% for section in sections %}

                    <div class="card section-card">
                        <div class="card-header section-header" id="heading{{section.section_id}}">
                            <div class="mb-0 d-flex flex-row justify-content-between">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse{{section.section_id}}" aria-expanded="true" aria-controls="collapse{{section.section_id}}">
                                    <span class="bebas section-header" style="font-size:1.5rem; display:inline; line-height:50px;"> {{section.header}} </span>
                                </button>
                            </div>
                        </div>

                        <div id="collapse{{section.section_id}}" class="collapse " aria-labelledby="heading{{section.section_id}}">
                            <div class="card-body" style="white-space: pre-line; ">
                                <p class="text-wrap mb-0">{{section.body}}</p>
                                <div>
                                    <button class="btn" data-toggle="modal" data-target="#editSection" style="background-color: #CBCD88; border-radius:50%; height:40px;width:40px;">
                                        <span class="material-icons m-0" style="color:white; display:inline; line-height:1.5rem;">edit</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                {% endfor %}
            {% endif %}
            
            <section id="newSections">
                
            </section>

            <button id='addSection' type="button" class="btn rounded mt-3" style="width:100%; background-color: #F5F2EA;">
                <span class="material-icons">add</span>
            </button>

        </div>
            
        <!-- Gallery -->
        <section id="gallery" class="d-flex flex-row flex-nowrap rounded mt-3 justify-content-between" style="background-color: #F5F2EA;">
            <div id="btn-div" >
                <!-- Add Image Btn -->
                <button class="btn" data-toggle="modal" data-target="#addimage" style="background-color: #CBCD88; border-radius:50%; height:40px;width:40px;">
                    <span class="material-icons m-0" style="color:white; display:inline; line-height:1.5rem;">add_photo_alternate</span>
                </button>
            </div>

                <!-- Add image modal -->
                <div id="addimage" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="addNewImageModal" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                      <div class="mymodal modal-content d-flex flex-column p-3">
                        <div class="d-flex flex-row justify-content-end">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">X</button>
                        </div>
                        
                        <form action="/file-view/{{open_file.file_id}}/add-image" method="post">
                            {{image_form.csrf_token}}

                            {{image_form.image_name.label(class="bebas mb-0 mt-2", style="font-size:1.5rem;")}}
                            {{image_form.image_name(class="form-control old")}}
                            {{image_form.image_link.label(class="bebas mb-0 mt-2", style="font-size:1.5rem;")}}
                            {{image_form.image_link(class="form-control old")}}
                            <div class="d-flex justify-content-end"> 
                                {{image_form.submit(class="btn mt-3 bebas", style="background-color:#CBCD88; color:white; border:0px solid transparent;")}}
                            </div>

                        </form>
                        
        
                    </div>
                </div>

            </div>
            <div id="left-gallery-div" class="ml-3 mt-3 mb-3 mr-1" >
                <div>
                    <h1 class="bebas" style="font-size: 2rem;">Gallery</h1>
                </div>

                <div id="image-list-div" class="rounded p-3" style="background-color:white;">
                    <!-- List of images with options to delete
                    -name
                    -date added -->
                    {% if images == None %}
                    <h2 class="bebas" style="font-size:1.5rem;"> No Images... </h2>
                    {% else %}
                    {% endif %}
                </div>
            </div>
            
            <div id="right-gallery-div" class="mr-3 ml-1 mt-3 mb-3" >

                {% if images == None %}
                    <h2 class="bebas m-3 pl-4 pr-4 pt-2 pb-2" style="font-size:1.5rem;"> No Images... </h2>
                {% else %}
                <div id="galleryCarousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        {% for image in images %}
                        <div class="carousel-item">
                            <img class="d-block" src=" {{image.image_path}} " alt="{{image.public_id}}">
                        </div>
                        {% endfor %}
                    </div>
                    
                    <a class="carousel-control-prev" href="#galleryCarousel" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#galleryCarousel" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>    
                </div>
                {% endif %}
            </div>
        </section>
    </div>

    <script>
        const addSectionBtn = document.getElementById("addSection");
        const closeSectionBtn = document.getElementById("closeSectionCreation")
        const firstImage = document.querySelector('.carousel-item')
        
        if(firstImage){
            firstImage.classList.add('active')
        }
        if(addSectionBtn){
            addSectionBtn.addEventListener('click', addSectionClicked)
        }
        if(closeSectionBtn){
            closeSectionBtn.addEventListener('click', CloseSectionCreation)
        }


        function addSectionClicked () {
            let html = `<div id="NewSection" class="section-div mt-3"><div class="d-flex justify-content-end"><button id="closeSectionCreation" class="btn" type="button" style="background-color:transparent;"><span class="material-icons">close</span></button></div><form action="/file-edit/{{open_file.file_id}}/add-section" method="post" class="m-2"><div id="sectionName" class="d-flex flex-row justify-content-between form-group"><label for="sectionName" class="bebas mb-0" style="width: 200px; font-size:1.5rem;">Section Name</label><input type="text" class="form-control old" id="sectionName" name="sectionName" placeholder="Section Name"></div><div id="sectionBody" class="d-flex flex-column justify-content-between form-group"><label for="sectionBody" class="bebas" style="width: 200px; font-size:1.5rem;">Section Body</label><textarea name="sectionBody" id="sectionBody" rows="5" class="form-control old" placeholder="..."></textarea></div><div class="d-flex flex-row justify-content-end form-group mb-0"><button type="submit" class="btn bebas" style="background-color: #CBCD88; color:white;">Create</button></div></form></div>`    
            const sections_section = document.getElementById('newSections');
            sections_section.insertAdjacentHTML('afterbegin', html);
            document.getElementById("addSection").remove()

            document.getElementById("closeSectionCreation").addEventListener('click', CloseSectionCreation)
        }

        function CloseSectionCreation(){
            let html = `<button id='addSection' type="button" class="btn rounded mt-3" style="width:100%; background-color: #F5F2EA;"><span class="material-icons">add</span></button>`

            document.getElementById('NewSection').remove()
            
            document.getElementById('newSections').insertAdjacentHTML('afterend', html)

            document.getElementById("addSection").addEventListener('click', addSectionClicked)
        }

    </script>
{% endblock %}